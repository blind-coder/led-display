#include <stdio.h>
#include <unistd.h>
#include <string.h>
#include <time.h>

#include "libleddisplay.h"
#include "binconst.h"

#define DEBUG 1

#define FRAME_DURATION  1500

int main(int argc, char *argv[]) {

#if DEBUG
  // no output buffering please
  setbuf(stdout, 0);
#endif

  printf("--------------------------------------------\n");
  printf("Glyph: Testing glyphs for a USB LED display.\n");
  printf("Written by Nick Pope\n");
  printf("--------------------------------------------\n");

  // initialise device
  if (ldisplay_init() != SUCCESS) {
    fprintf(stderr, "\033[1;31mDevice failed to initialise!\033[0m\n");
    return 1;
  }

  printf("Connected to the display.\n");
  printf("Resetting...\n");

  // reset it to a known initial state
  //ldisplay_reset();

  ldisplay_buffer_t frames[18] = {
    { // Hollow Diamond
      B24(00000, 00000000, 00001000),
      B24(00000, 00000000, 00010100),
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00100010),
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00010100),
      B24(00000, 00000000, 00001000)
    },
    { // Filled Diamond
      B24(00000, 00000000, 00001000),
      B24(00000, 00000000, 00011100),
      B24(00000, 00000000, 00011100),
      B24(00000, 00000000, 00111110),
      B24(00000, 00000000, 00011100),
      B24(00000, 00000000, 00011100),
      B24(00000, 00000000, 00001000)
    },
    { // Hollow Heart
      B24(00000, 00000000, 00010100),
      B24(00000, 00000000, 00101010),
      B24(00000, 00000000, 00100010),
      B24(00000, 00000000, 00100010),
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00010100),
      B24(00000, 00000000, 00001000)
    },
    { // Filled Heart
      B24(00000, 00000000, 00010100),
      B24(00000, 00000000, 00111110),
      B24(00000, 00000000, 00111110),
      B24(00000, 00000000, 00111110),
      B24(00000, 00000000, 00011100),
      B24(00000, 00000000, 00011100),
      B24(00000, 00000000, 00001000)
    },
    { // Hollow Club
      B24(00000, 00000000, 00001000),
      B24(00000, 00000000, 00010100),
      B24(00000, 00000000, 00010100),
      B24(00000, 00000000, 00100010),
      B24(00000, 00000000, 00010100),
      B24(00000, 00000000, 00001000),
      B24(00000, 00000000, 00011100)
    },
    { // Filled Club
      B24(00000, 00000000, 00001000),
      B24(00000, 00000000, 00011100),
      B24(00000, 00000000, 00011100),
      B24(00000, 00000000, 00111110),
      B24(00000, 00000000, 00011100),
      B24(00000, 00000000, 00001000),
      B24(00000, 00000000, 00011100)
    },
    { // Hollow Spade
      B24(00000, 00000000, 00001000),
      B24(00000, 00000000, 00010100),
      B24(00000, 00000000, 00100010),
      B24(00000, 00000000, 00100010),
      B24(00000, 00000000, 00010100),
      B24(00000, 00000000, 00001000),
      B24(00000, 00000000, 00011100)
    },
    { // Filled Spade
      B24(00000, 00000000, 00001000),
      B24(00000, 00000000, 00011100),
      B24(00000, 00000000, 00111110),
      B24(00000, 00000000, 00111110),
      B24(00000, 00000000, 00011100),
      B24(00000, 00000000, 00001000),
      B24(00000, 00000000, 00011100)
    },
    { // Sun
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00011000),
      B24(00000, 00000000, 00111100),
      B24(00000, 00000000, 00111100),
      B24(00000, 00000000, 00111100),
      B24(00000, 00000000, 00011000),
      B24(00000, 00000000, 00000000)
    },
    { // Moon
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00011000),
      B24(00000, 00000000, 00110000),
      B24(00000, 00000000, 00100000),
      B24(00000, 00000000, 00110100),
      B24(00000, 00000000, 00011000),
      B24(00000, 00000000, 00000000)
    },
    { // Cloud
      B24(00000, 00000000, 00010000),
      B24(00000, 00000000, 00101000),
      B24(00000, 00000000, 01000110),
      B24(00000, 00000000, 01000010),
      B24(00000, 00000000, 00111100),
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00000000)
    },
    { // Rain
      B24(00000, 00000000, 00011000),
      B24(00000, 00000000, 00011000),
      B24(00000, 00000000, 01111110),
      B24(00000, 00000000, 01111110),
      B24(00000, 00000000, 00111100),
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 01010100)
    },
    { // Lightning
      B24(00000, 00000000, 00000100),
      B24(00000, 00000000, 00001000),
      B24(00000, 00000000, 00011000),
      B24(00000, 00000000, 00011100),
      B24(00000, 00000000, 00001100),
      B24(00000, 00000000, 00001000),
      B24(00000, 00000000, 00010000)
    },
    { // Snow
      B24(00000, 00000000, 00010000),//00001000),
      B24(00000, 00000000, 01000100),//00011100),
      B24(00000, 00000000, 00000000),//00001000),
      B24(00000, 00000000, 00101000),//00111110),
      B24(00000, 00000000, 00000010),//00001000),
      B24(00000, 00000000, 01000000),//00011100),
      B24(00000, 00000000, 00010100) //00001000)
    },
    { // Fog
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 01111000),
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00011110),
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00111100),
      B24(00000, 00000000, 00000000)
    },
    { // Face - Happy
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00010100),
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00100010),
      B24(00000, 00000000, 00011100),
      B24(00000, 00000000, 00000000)
    },
    { // Face - Unhappy
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00010100),
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00011100),
      B24(00000, 00000000, 00100010),
      B24(00000, 00000000, 00000000)
    },
    { // Face - Normal
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00010100),
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00111110),
      B24(00000, 00000000, 00000000),
      B24(00000, 00000000, 00000000)
    },
  };

  //ldisplay_setBrightness(LDISPLAY_BRIGHT);
  printf("Displaying...\n");

  int i;
  for (i = 0; i < sizeof(frames)/sizeof(ldisplay_buffer_t); i++) {
    ldisplay_set(FRAME_DURATION, frames[i], LDISPLAY_BRIGHT, NULL);
  }

  ldisplay_wait_for_anim();
  ldisplay_reset(10, NULL);
  printf("Cleaning up...\n");
  ldisplay_cleanup();
  printf("Done.\n");
  return 0;
}

// vim:ts=2:sw=2:et
